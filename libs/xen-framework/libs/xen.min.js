var Class=function(){this.initialize&&this.initialize.apply(this,arguments)};Class.extend=function(c){var b=this,a=function(){return b.apply(this,arguments)};a.extend=b.extend;var h=function(){};h.prototype=b.prototype;a.prototype=new h;for(var f in c)a.prototype[f]=c[f];return a};this.xen=this.xen||{};
(function(){var c=function(a){this.initialize(a)},b=c.prototype;b.actions={};b.onEvent=function(a){};b.states={normal:{label:"E1"},rollover:{label:"E2",noise:{code:""},ib:{id:"",position:12}},click:{label:"E2",noise:{code:""},ib:{id:"",position:12}},rollout:{label:"E1"}};b.initialize=function(a){console.log("initialize");void 0!=a.clip?(console.log(a.clip),this.clip=a.clip,this._initializeClip(),this._overdubEvents(a)):void 0!=a.id&&(console.log(a.id),this.lib=window[a.id],void 0==this.lib?require([xen.config.directories.animations+
"/"+a.id+"/html5/"+a.id],function(){this.lib=window[a.id];b.call(this,a)}.bind(this)):b.call(this,a));var b=function(a){console.log("loadLib "+b);console.log("Noel had manifest error here");if(0<this.lib.properties.manifest.length){var g=new createjs.LoadQueue(!1);g.installPlugin(createjs.Sound);g.addEventListener("fileload",e.bind(this));g.addEventListener("error",d.bind(this));g.addEventListener("complete",c.bind(this));console.log(this.lib.properties.manifest);console.log("this.lib.properties.manifest was UNDEFINED");
for(var k=0;k<this.lib.properties.manifest.length;k++)this.lib.properties.manifest[k].src=xen.config.directories.animations+"/"+a.id+"/html5/"+this.lib.properties.manifest[k].src;g.loadManifest(this.lib.properties.manifest)}else c.call(this)},c=function(b){this.clip=new this.lib.CLIP;this._initializeClip();this._overdubEvents(a);a.onLoaded()},d=function(a){console.log(a)},e=function(a){console.log(a);"image"==a.item.type&&(images[a.item.id]=a.result)}};b._initializeClip=function(){console.log("initializeClip");
console.log(this);this.clip instanceof createjs.MovieClip&&(this.clip.gotoAndStop(0),this._labelAnalyser=new ClipLabelAnalysis(this),this.currentLabelIndex,this.labels=this.clip.getLabels());this.onEvents={labelEnter:this.onEvent,labelExit:this.onEvent,error:this.onEvent,finished:this.onEvent};c.arrangeFlashClipsNames(this.clip)};b._overdubEvents=function(a){console.log("_overdubEvents");void 0!=a&&(void 0!=a.onEvent&&("function"==typeof a.onEvent?this.onEvents.labelEnter=this.onEvents.labelCreated=
this.onEvents.labelExit=this.onEvents.finished=this.onEvents.error=this.onEvents.click=this.onEvents.rollover=this.onEvents.normal=a.onEvent:(void 0!=a.onEvent.labelEnter&&(this.onEvents.labelEnter=a.onEvent.labelEnter),void 0!=a.onEvent.labelCreated&&(this.onEvents.labelCreated=a.onEvent.labelCreated),void 0!=a.onEvent.labelExit&&(this.onEvents.labelExit=a.onEvent.labelExit),void 0!=a.onEvent.finished&&(this.onEvents.finished=a.onEvent.finished),void 0!=a.onEvent.error&&(this.onEvents.error=a.onEvent.error),
void 0!=a.onEvent.click&&(this.onEvents.click=a.onEvent.click),void 0!=a.onEvent.rollover&&(this.onEvents.rollover=a.onEvent.rollover),void 0!=a.onEvent.normal&&(this.onEvents.normal=a.onEvent.normal))),void 0!=a.states&&(this.states=a.states))};b.gotoLabel=function(a,b){console.log("gotoLabel "+a);this._overdubEvents(b);for(var f=!1,d=0;d<this.labels.length;d++)if(a==this.labels[d].label){f=!0;this.currentLabelIndex=d;break}0==f?(console.log("label "+a+"not found on "+this.clip.name),this._dispatchEvent({type:"error",
text:"label "+a+"not found on "+this.clip.name})):(this.clip.gotoAndStop(a),c.arrangeFlashClipsNames(this.clip),0!=this._dispatchEvent({type:"labelEnter",label:a})&&(this._labelAnalyser.check(function(a){switch(a.event){case "finished":this._dispatchEvent({type:"finished"})}}),this._dispatchEvent({type:"labelCreated",label:a})))};b.playLabel=function(a,b){console.log("playLabel "+a+" "+b.toString());this.onEvents.externfinished=b.onEvent.finished;b.onEvent.finished=this._onLabelFinished;this.gotoLabel(a,
b)};b.getChildByName=function(a){for(var b=this.clip.children,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null};b._dispatchEvent=function(a){console.log("_dispatchEvent "+a.type);console.log(this.onEvents[a.type]);return void 0==this.onEvents[a.type]?!0:this.onEvents[a.type].apply(this,[a])};b._labelAnalyser=null;b._onLabelFinished=function(a){console.log("currentLabelIndex "+this.currentLabelIndex);this.currentLabelIndex+1<this.labels.length?(console.log("nextLabel "+this.labels[this.currentLabelIndex+
1].label),this.gotoLabel(this.labels[this.currentLabelIndex+1].label)):this.onEvents.externfinished.apply(this,[{event:"finished"}])};Object.defineProperty(b,"totalFrames",{get:function(){return this.clip.timeline.duration}});b._enabled=!1;Object.defineProperty(b,"enabled",{get:function(){return this._enabled},set:function(a){console.log("enabled "+a);a!=this._enabled&&((this._enabled=a)?this._enableInteractivity():this._disableInteractivity())}});b._clickHandler=function(a,b){console.log("click "+
this.clip.name);void 0!=this.states.rollover.sound&&(this.states.rollover.sound.stop(),this.states.rollover.sound=void 0);void 0!=this.states.click.noise&&(this.states.click.sound=createjs.Sound.play("B_"+xen.config.moduleID+"_"+this.states.click.noise.code));void 0!=this.states.click.label&&this.gotoLabel(this.states.click.label);this._dispatchEvent({type:"click",target:this})};b._rolloverHandler=function(a,b){console.log("rollover "+this);void 0!=this.states.rollover.noise&&(this.states.rollover.sound=
createjs.Sound.play("B_"+xen.config.moduleID+"_"+this.states.rollover.noise.code));void 0!=this.states.rollover.label&&this.gotoLabel(this.states.rollover.label);this._dispatchEvent({type:"rollover",target:this})};b._rolloutHandler=function(a,b){console.log("rollout "+this);void 0!=this.states.rollover.sound&&(this.states.rollover.sound.stop(),this.states.rollover.sound=void 0);void 0!=this.states.normal.label&&this.gotoLabel(this.states.normal.label);this._dispatchEvent({type:"normal",target:this})};
b._enableInteractivity=function(){console.log("_enableInteractivity");console.log(this);this.clip.on("click",this._clickHandler,this,!1);this.clip.on("rollover",this._rolloverHandler,this,!1);this.clip.on("rollout",this._rolloutHandler,this,!1);this.clip.cursor="pointer"};b._disableInteractivity=function(){console.log("_disableInteractivity");console.log(this);this.clip.removeAllEventListeners("click");this.clip.removeAllEventListeners("rollover");this.clip.removeAllEventListeners("rollout");this.clip.cursor=
"auto"};c.getChildrenByName=function(a,b){for(var c=[],d=0;d<a.children.length;d++){var e=a.children[d];e.name==b&&c.push(e)}return c};c.arrangeFlashClipsNames=function(a){for(var b in a)"parent"!=b&&"shape"!=b&&a[b]instanceof createjs.DisplayObject&&(a[b].name=b)};xen.Clip=c})();var ClipLabelAnalysis=function(c){this.target=c;this.clip=c.clip;this._callback=null;var b,a=[];this.mainAction="sound";this.check=function(c){this._callback=c;c=this.clip.getCurrentLabel();a=[];console.log("check "+b+", "+c);null!=c&&c!==b&&(console.log("NEW LABEL : "+c),this.clip.stop(),b=c,this._playComment(),this._callCustomFunction())};this._callCustomFunction=function(){if(void 0!=this.target.actions[b])this.target.actions[b]();else try{console.log("src/"+b),require("src/"+b)()}catch(a){}};
this._playComment=function(){for(var c=!1,f="S_"+xen.config.lang+"_"+xen.config.moduleID+"_"+b.substr(1),d=0;d<xen.config.ressources.length;d++)if(xen.config.ressources[d].id==f){c=!0;break}1==c&&(xen.comment.play(f,"ZAP",this._finish.bind(this,f)),a.push({id:f,type:"sound"}))};this._playAnimsOnce=function(){for(var b=xen.Clip.getChildrenByName(this.target,"^anim_"),c=0;c<b.length;c++){var d=new XenClip({clip:b[c]});a.push({id:d.name,type:"anim"});d.play(0,"end",this._finish.bind(this,actionID))}};
this._showTextes=function(){};this._showPhotos=function(){};this._showVideos=function(){};this._finish=function(b){console.log("finish "+b);for(var c=0;c<a.length;c++)a[c].id==b&&a.splice(c,1);0==a.length&&this._callback.apply(this.target,[{event:"finished"}])}};this.xen=this.xen||{};
(function(){var c=function(){this.initialize()},b=c.prototype;b.initialize=function(){this._initClicZap()};b._currentComment=null;b._currentCommentCallback=null;b.play=function(a,b,c){this.cancel();this._currentCommentCallback=c;this._currentComment={id:a};console.log("playComment id : "+this._currentComment.id);this._currentComment.sound=createjs.Sound.play(this._currentComment.id);this._currentComment.sound.on("complete",this._commentFinished,this);"ZAP"==b&&this._clipZapShow(!0)};b._commentFinished=
function(){console.log("_commentFinished");this._currentComment.sound.removeEventListener("complete",this._commentFinished);this._clipZapShow(!1);null!=this._currentCommentCallback&&null!=this._currentCommentCallback.handleEvent?this._currentCommentCallback.handleEvent.apply(this._currentCommentCallback.thisObj):null!=this._currentCommentCallback&&this._currentCommentCallback()};b.stop=function(){console.log("stopComment");console.log(this);this._clipZapShow(!1);this._currentComment.sound.stop();
this._currentComment.sound.removeEventListener("complete",this._commentFinished);null!=this._currentCommentCallback&&null!=this._currentCommentCallback.handleEvent?this._currentCommentCallback.handleEvent.apply(this._currentCommentCallback.thisObj):null!=this._currentCommentCallback&&this._currentCommentCallback()};b.cancel=function(){console.log("cancelComment");null!=this._currentComment&&(this._currentComment.sound.stop(),this._currentComment.sound.removeEventListener("complete",this._commentFinished),
this._clipZapShow(!1),this._currentComment=this._currentCommentCallback=null)};b._initClicZap=function(){console.log("_initClicZap");this.clicZap=new createjs.Shape;this.clicZap.graphics.beginFill("#ff0000").drawRect(0,0,800,600);this.clicZap.alpha=xen.config.commentClicZapAlpha};b._clipZapShow=function(a){1==a?(this.clicZap.on("click",this.stop,this),stage.addChild(this.clicZap)):(this.clicZap.removeAllEventListeners(),stage.removeChild(this.clicZap))};xen.CommentPlayer=c})();this.xen=this.xen||{};(function(){xen.Config=function(){this.configPath="";this.ressources=this.configXML=null;this.lang="FR";this.framerate=24;this.moduleID="";this.directories={animations:"A_moduleID"};this.capsuleAlgo=null;this.commentClicZapAlpha=.01;this.commentPriorAnim=this.ENABLE_MOUSE_OVER=!0}})();function Diaporama(){this.speed=1;this.photos=[]};(function(){xen.Initializer=function(){this.init=function(){console.log("Initializer.init");require((void 0==xen.Config?[xenPath+"/src/Config.js",xenPath+"/src/Tools.js",xenPath+"/src/ClipLabelAnalysis.js",xenPath+"/src/Preload.js",xenPath+"/src/Clip.js",xenPath+"/src/Memo.js",xenPath+"/src/CommentPlayer.js",xenPath+"/src/SoundPlayer.js",xenPath+"/src/MusicPlayer.js"]:[]).concat(moduleRequired),function(){console.log("init1");xen.config=new xen.Config;xen.comment=new xen.CommentPlayer;xen.memo=new xen.Memo;
xen.sound=new xen.SoundPlayer;xen.music=new xen.MusicPlayer;console.log(xen.Tools);xen.tools=xen.Tools;console.log(xen.tools);xen.tools.loadXML("localConfig.xml",!0,c)})};var c=function(a){a=a.result.getElementsByTagName("xml")[0].getAttribute("src");console.log(a);xen.config.configPath=a;xen.tools.loadXML(xen.config.configPath,!0,b)},b=function(b){xen.config.configXML=b.result;console.log(xen.config.configXML);xen.config.moduleID=xen.config.configXML.getElementsByTagName("ModuleInfo")[0].getAttribute("id");
xen.config.directories.animations="A_"+xen.config.moduleID;b=xen.config.configXML.getElementsByTagName("Resource");var c=[];console.log(b.length);for(var d=0;d<b.length;d++){for(var e=b[d].attributes,l={},g=0;g<e.length;g++)l[e[g].name]=e[g].value;c.push(l)}console.log(c);xen.config.ressources=c;console.log("init2");xen.Preload=new xen.Preload(xen.config.ressources,a)},a=function(){console.log("init3");xen.initialized=!0;var a=document.getElementById("canvas");a.getContext("2d");stage=new createjs.Stage(a);
1==xen.config.ENABLE_MOUSE_OVER?stage.enableMouseOver():stage.enableMouseOver(0);createjs.Ticker.setFPS(xen.config.framerate);createjs.Ticker.addEventListener("tick",stage);xen.config.capsuleAlgo=new (require("src/CapsuleAlgo"));xen.config.capsuleAlgo.init()}}})();this.xen=this.xen||{};(function(){var c=function(){this.initialize()},b=c.prototype;b.initialize=function(){};b.setVariable=function(a,b){"undefined"!==typeof Storage?localStorage.setItem(a,JSON.stringify(b)):console.log("No Web Storage support")};b.getVariable=function(a,b){if("undefined"!==typeof Storage){var c=JSON.parse(localStorage.getItem(a));return null==c&&void 0!=b?(localStorage.setItem(a,JSON.stringify(b)),b):c}console.log("No Web Storage support");return null};xen.Memo=c})();this.xen=this.xen||{};(function(){var c=function(){this.initialize()},b=c.prototype;b.initialize=function(){};b.sound=null;b.play=function(a){void 0==a&&null!=this.sound?this.sound.play():void 0!=a?(this.stop(),this.sound=createjs.Sound.play("B_"+xen.config.moduleID+"_"+a)):console.log("no sound to play")};b.stop=function(){null!=this.sound&&this.sound.stop()};xen.MusicPlayer=c})();this.xen=this.xen||{};(function(){xen.Preload=function(c,b){function a(a){console.log(a.item.type+" charg\u00e9: "+a.item.id)}function h(a){console.log("Error!",a.text)}function f(a){console.log((100*e.progress|0)+" % Loaded")}function d(a){console.log("Finished Loading Assets");b()}console.log("xen.Preload");var e;0<c.length?(e=new createjs.LoadQueue(!1),e.installPlugin(createjs.Sound),e.on("fileload",a),e.on("progress",f),e.on("complete",d),e.on("error",h),e.loadManifest(c)):d()}})();this.xen=this.xen||{};(function(){var c=function(){this.initialize()},b=c.prototype;b.initialize=function(){};b.play=function(a){return createjs.Sound.play("B_"+xen.config.moduleID+"_"+a)};b.stopAll=function(){createjs.Sound.stop()};xen.SoundPlayer=c})();this.xen=this.xen||{};(function(){var c=function(){this.initialize()},b=c.prototype;b.initialize=function(){};b.create=function(a){};xen.Texts=c})();this.xen=this.xen||{};(function(){var c=function(){};c.gimme2digits=function(b){return 10>b?"0"+b:b};c.g2d=c.gimme2digits;c.loadXML=function(b,a,c){1==(void 0==a?!0:a)?(a=new createjs.LoadQueue(!1,"",!0),a.addEventListener("fileload",c),a.loadFile(b)):(window.DOMParser?a=(new DOMParser).parseFromString(window[b],"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async=!1,a.loadXML(window[b])),c({result:a}))};xen.Tools=c})();var stage;this.xen=this.xen||{};(function(){xen.initialized=!1;xen.tools=null;xen.config=null;xen.sound=null;xen.comment=null;xen.music=null;xen.memo=null;xen.text=null;xen.video=null;xen.image=null;xen.init=function(){!0===xen.initialized?console.log("xen already initialized"):require(["src/ModuleConfig"],function(){void 0===xen.Initializer?require([xenPath+"/src/Initializer.js"],function(){(new xen.Initializer).init()}):(new xen.Initializer).init()})}})();
function playSound(c,b){console.log("ps "+c);createjs.Sound.play(c,createjs.Sound.INTERRUPT_EARLY,0,0,b)};
